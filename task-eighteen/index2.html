<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./style2.css">
</head>

<body>
    <canvas id="xxx" width="300px" height="300px"></canvas>
    <div id="actions" class="actions">
        <button id="eraser">橡皮擦</button>
        <button id="brush">画笔</button>
    </div>

    <script>
        var canvas = document.getElementById('xxx');
        var context = canvas.getContext('2d');

        autoSetCanvasSize(canvas)

        listenToMouse(canvas)

        var eraserEnable = false
        eraser.onclick = function () {
            eraserEnable = true;
            actions.className = 'actions x';
        }
        brush.onclick = function () {
            eraserEnable = false;
            actions.className = 'actions';
        }

        //监听画板尺寸
        function autoSetCanvasSize(canvas) {
            setCanvasSize()

            window.onresize = function () {
                setCanvasSize()
            }

            function setCanvasSize() {
                var pageWidth = document.documentElement.clientWidth;
                var pageHeight = document.documentElement.clientHeight;

                canvas.width = pageWidth;
                canvas.height = pageHeight;
            }
        }

        //画线
        function drawLine(x1, y1, x2, y2) {
            context.beginPath();
            context.lineWidth = 2;
            context.moveTo(x1, y1);
            context.lineTo(x2, y2);
            context.stroke();
            context.closePath();
        }

        //监听鼠标
        function listenToMouse(canvas) {
            var using = false;
            var lastPoint = {
                x: undefined,
                y: undefined
            }
            canvas.onmousedown = function (aaa) {
                var x = aaa.clientX;
                var y = aaa.clientY;
                using = true;
                if (eraserEnable) {
                    context.clearRect(x - 5, y - 5, 10, 10)
                } else {
                    lastPoint = {
                        x: x,
                        y: y
                    }
                }
            }
            canvas.onmousemove = function (aaa) {
                var x = aaa.clientX;
                var y = aaa.clientY;

                if (!using) {
                    return
                }
                if (eraserEnable) {
                    context.clearRect(x - 5, y - 5, 10, 10)
                } else {
                    using = true;
                    var newPoint = {
                        x: x,
                        y: y
                    }
                    drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y);
                    lastPoint = newPoint;
                }
            }
            canvas.onmouseup = function (aaa) {
                using = false;
            }
        }
    </script>
</body>

</html>